{"version":3,"sources":["../../../../../assets/Script/Model/assets/Script/Model/Ball.js"],"names":["cc","Class","extends","Component","properties","type","get","node","name","x","y","row","set","num","column","findSameInColumn","_ele","_array","tmp","i","length","push","findLowestRow","log","touchRelease","eventTouch","plateController","effectArea","active","zIndex","canConnectballs","forEach","v","lineController","connectedBalls","emptyPositionX","emptyPositionY","emptyPostions","removeFromParent","generateFallingBall","clearLines","filterBalls","balls","returnBalls","fiballs","filter","element","roundBalls","ball","Math","abs","alreadyConnected","includes","indexOf","setListener","on","Node","EventType","TOUCH_START","dot","instantiate","dotPrefab","parent","children","setPosition","getPosition","TOUCH_MOVE","convertToNodeSpaceAR","touch","_point","TOUCH_END","TOUCH_CANCEL","onCollisionEnter","other","self","drawLine","pop","clearLastLine","onLoad","getComponent","start"],"mappings":"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","file":"Ball.js","sourceRoot":"../../../../../assets/Script/Model","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\nimport {\n    ANITIME\n} from '../Config/Config';\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        type: {\n            get() {\n                return this.node.name;\n            }\n        },\n        x: {\n            get() {\n                return this.node.x;\n            }\n        },\n        y: {\n            get() {\n                return this.node.y;\n            }\n        },\n        row: {\n            get() {\n                return this.node.row;\n            },\n            set(num) {\n                this.node.row = num;\n            }\n        },\n        column: {\n            get() {\n                return this.node.column;\n            },\n            set(num) {\n                this.node.column = num;\n            }\n        },\n    },\n    findSameInColumn(_ele,_array){//检查列中重复项\n        let tmp = [];\n        for(let i=0;i<_array.length;i++){\n            if(_ele==_array[i]){\n               tmp.push(_ele); \n            }\n        }\n        return tmp;\n    },\n    findLowestRow(){\n        cc.log('findLowestRow');\n    },\n    // LIFE-CYCLE CALLBACKS:\n    touchRelease(eventTouch) {\n        this.plateController.effectArea.active = false;\n        this.node.zIndex = 0;\n        this.canConnectballs.forEach(function (v) {\n            v.zIndex = 0;\n        })\n        // cc.log(this.lineController.connectedBalls);\n        //检测是否可消除\n        if(this.lineController.connectedBalls.length>=3){\n            this.emptyPositionX = [];\n            this.emptyPositionY = [];\n            this.lineController.connectedBalls.forEach(v=>{\n                this.plateController.emptyPostions.push(v);\n                v.removeFromParent(false);\n            })\n            this.plateController.generateFallingBall()\n            this.lineController.clearLines();\n        }\n        this.lineController.connectedBalls = [];\n    },\n    filterBalls(balls, type) { //筛选球\n        let returnBalls = [];\n        for (let i = 0; i < balls.length; i++) {\n            let fiballs = balls.filter(function (v) {\n                return v.name == type\n            });\n            fiballs.forEach(element => {\n                returnBalls.push(element);\n            });\n        }\n        return returnBalls;\n    },\n    roundBalls(ball) { //返回周围球(ball传入最后入队列的球)\n        if (Math.abs(ball.row - this.row) < 2 && Math.abs(ball.column - this.column) < 2) {\n            return true;\n        } else {\n            return false;\n        }\n    },\n    alreadyConnected(ball) { //验证球是否已经在队列里\n        if (this.lineController.connectedBalls.includes(ball)) {\n            if(this.lineController.connectedBalls.indexOf(ball)==this.lineController.connectedBalls.length-2)\n                return true;\n            else{\n                return 'nothing';\n            }\n        } else {\n            return false;\n        }\n    },\n    setListener() {\n        this.node.on(cc.Node.EventType.TOUCH_START, function (eventTouch) {\n            this.plateController.effectArea.active = true; //激活遮罩\n            this.node.zIndex = 1; //设置选中珠子盖在遮罩上\n            this.canConnectballs = this.filterBalls(this.plateController.balls, this.node.name);\n            this.canConnectballs.forEach(v => {\n                v.zIndex = 1;\n            }) //设置所有同颜色珠子盖在遮罩上\n            this.dot = cc.instantiate(this.plateController.dotPrefab); //创建触摸点\n            this.dot.parent = this.node.parent.parent.children[1]; //触摸点添加到LineArea\n            this.dot.setPosition(this.node.getPosition()); //设置触摸点位置为圆心\n        }, this);\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, function (eventTouch) {\n            this.dot.setPosition(this.node.parent.convertToNodeSpaceAR(eventTouch.touch._point));\n        }, this);\n\n        this.node.on(cc.Node.EventType.TOUCH_END, this.touchRelease, this);\n        this.node.on(cc.Node.EventType.TOUCH_CANCEL, this.touchRelease, this);\n    },\n    onCollisionEnter: function (other, self) {\n        if (this.lineController.connectedBalls.length == 0) {\n            this.lineController.connectedBalls.push(self.node);\n        } else {\n            if (self.node.zIndex == 1) { //判断高亮\n                if (this.roundBalls(this.lineController.connectedBalls[this.lineController.connectedBalls.length - 1])) { //判断附近球\n                    switch(this.alreadyConnected(self.node)){\n                        case false://添加到队列里\n                            this.lineController.connectedBalls.push(self.node);\n                            this.lineController.drawLine();\n                            break;\n                        case true://从队列里删除\n                            this.lineController.connectedBalls.pop(self.node);\n                            this.lineController.clearLastLine();\n                            break;\n                        case 'nothing'://什么都不做\n                            break;\n                    }\n                }\n            }\n        }\n    },\n\n    onLoad() {\n        this.setListener();\n        this.plateController = this.node.parent.parent.getComponent(\"PlateController\");\n        this.lineController = this.node.parent.parent.children[1].getComponent(\"LineController\");\n        \n    },\n\n    start() {\n\n    },\n\n    // update (dt) {},\n});"]}