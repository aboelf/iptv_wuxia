{"version":3,"sources":["../../../../../assets/Script/Controller/assets/Script/Controller/PlateController.js"],"names":["window","Global","plateController","lineController","cc","Class","extends","Component","properties","blockPrefab","Prefab","dotPrefab","debug","ballPrefabs","default","type","ballArea","Node","lineArea","effectArea","emptyPostions","randomRange","min","max","Math","random","randomRangeInt","arguments","length","floor","drawBalls","blockSize","x_0","sqrt","i","j","block","instantiate","children","color","Color","getComponent","Label","string","active","width","height","row","column","addChild","setPosition","v2","generateFallingBall","fallingBall","Set","name","oriBall","parent","distance","ball","add","generateNewBalls","balls","key","hasOwnProperty","count","Number","updateBall","that","forEach","fallDown","v","destroy","onLoad","zIndex","log","isInPlayAni","manager","director","getCollisionManager","enabled","start"],"mappings":"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","file":"PlateController.js","sourceRoot":"../../../../../assets/Script/Controller","sourcesContent":["window.Global = {\n    plateController: null,\n    lineController: null,\n    // map:null\n};\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        blockPrefab: cc.Prefab,\n        dotPrefab: cc.Prefab,\n        debug: true,\n        ballPrefabs: {\n            default: [],\n            type: [cc.Prefab]\n        },\n        ballArea: cc.Node,\n        lineArea: cc.Node,\n        effectArea: cc.Node,\n        emptyPostions: [],\n        // map:[],       \n    },\n\n    // LIFE-CYCLE CALLBACKS:\n    randomRange(min, max) {\n        return Math.random() * (max - min) + min;\n    },\n    randomRangeInt(min, max) {\n        if (arguments.length == 2) {\n            return Math.floor(this.randomRange(min, max));\n        } else if (arguments.length == 1) {\n            return arguments[0][Math.floor(this.randomRange(0, arguments[0].length))];\n        }\n    },\n    //根据this.map绘制珠盘\n    drawBalls() {\n        this.blockSize = 94;\n        let x_0 = 2 * this.blockSize / Math.sqrt(3);\n        for (let i = 0; i < 6; i++) {\n            // let row = [];\n            for (let j = 0; j < 7; j++) {\n                if (i == 5 && j % 2 != 0) {\n                    //删除顶端3个珠子\n                } else {\n                    let block = cc.instantiate(this.ballPrefabs[this.randomRangeInt(0, 5)]);\n                    if (this.debug) {\n                        block.children[0].color = new cc.Color(0, 0, 0);\n                        block.children[0].getComponent(cc.Label).string = i + ' ' + j;\n                    } else {\n                        block.children[0].active = false;\n                    }\n                    block.width = 150;\n                    block.height = 150;\n                    block.row = i;\n                    block.column = j;\n                    this.ballArea.addChild(block);\n                    if (j % 2 == 0) {\n                        block.setPosition(cc.v2(j * Math.sqrt(3) * this.blockSize + x_0, this.blockSize + 2 * this.blockSize * i));\n                    } else {\n                        block.setPosition(cc.v2(j * Math.sqrt(3) * this.blockSize + x_0, 2 * this.blockSize + 2 * this.blockSize * i));\n                    }\n                }\n            }\n        }\n    },\n\n    generateFallingBall() {\n        this.fallingBall = new Set();\n        for (let i = 0; i < this.ballArea.children.length; i++) {\n            if (this.ballArea.children[i].name != \"effectArea\") {\n                let oriBall = this.ballArea.children[i];\n                if (oriBall.parent != null) {\n                    let distance = 0;\n                    for (let j = 0; j < this.emptyPostions.length; j++) {\n                        let ball = this.emptyPostions[j];\n                        if (oriBall.column == ball.column) {\n                            if (oriBall.row > ball.row) {\n                                distance += 1;\n                                continue;\n                            }\n                        }\n                    }\n                    if (distance > 0) {\n                        oriBall.distance = distance;\n                        this.fallingBall.add(oriBall);\n                    }\n                }\n            }\n        }\n    },\n    generateNewBalls() {\n        let balls = {\n            '0': 0,\n            '1': 0,\n            '2': 0,\n            '3': 0,\n            '4': 0,\n            '5': 0,\n            '6': 0\n        };\n        for (let i = 0; i < this.emptyPostions.length; i++) {\n            let ball = this.emptyPostions[i];\n            balls[ball.column] += 1;\n        }\n        for (const key in balls) {\n            if (balls.hasOwnProperty(key)) {\n                const count = balls[key];\n                if (count > 0) {\n                    for (let i = 0; i < count; i++) {\n                        let ball = cc.instantiate(this.ballPrefabs[this.randomRangeInt(0, 5)]);\n                        ball.children[0].active = false;\n                        ball.width = 150;\n                        ball.height = 150;\n                        ball.column = Number(key);\n                        if(ball.column%2!=0){\n                            ball.row = 5 + i\n                        }else{\n                            ball.row = 6 + i\n                        }\n                        this.ballArea.addChild(ball);\n                        if (ball.column % 2 == 0) {\n                            ball.setPosition(cc.v2(ball.column * Math.sqrt(3) * this.blockSize + 2 * this.blockSize / Math.sqrt(3), this.blockSize + 2 * this.blockSize * ball.row));\n                        } else {\n                            ball.setPosition(cc.v2(ball.column * Math.sqrt(3) * this.blockSize + 2 * this.blockSize / Math.sqrt(3), 2 * this.blockSize + 2 * this.blockSize * ball.row));\n                        }\n                    }\n                }\n            }\n        }\n    },\n    updateBall() {\n        let that = this;\n        this.fallingBall.forEach(function (ball, i) {\n            ball.getComponent(\"Ball\").fallDown(ball.distance);\n            ball.distance = 0;\n        })\n        this.fallingBall = []; //完成下坠队列\n        this.emptyPostions.forEach(function (v, i) {\n            v.destroy();\n        })\n        this.emptyPostions = []; //回收删除的珠子\n    },\n    onLoad() {\n        this.drawBalls();\n        this.effectArea.zIndex = 1;\n        cc.log(this.effectArea)\n        this.isInPlayAni = false;\n        var manager = cc.director.getCollisionManager();\n        manager.enabled = true;\n        Global.plateController = this;\n        Global.lineController = this.lineArea.getComponent('LineController');\n        // Global.map = this.map;\n    },\n\n    start() {\n\n    },\n\n    // update (dt) {},\n});"]}